pipeline {
    agent any
    stages {
        stage("Build") {
            steps {
                script {
                    echo "Building was successful"
                    echo "Tool: Maven"
                    // Assuming some build command here
                }
            }
            post {
                success {
                    notifyStatus("Build", "SUCCESS")
                }
                failure {
                    notifyStatus("Build", "FAILURE")
                }
            }
        }
        stage('Unit and Integration Tests') {
            steps {
                script {
                    echo "Unit and Integration Test passed"
                    echo "Tool: Junit"
                    sleep 10 // Simulate test duration
                }
            }
            post {
                success {
                    notifyStatus("Unit and Integration Tests", "SUCCESS")
                }
                failure {
                    notifyStatus("Unit and Integration Tests", "FAILURE")
                }
            }
        }
        stage('Code Analysis') {
            steps {
                script {
                    echo "Code Analysis: Completed"
                    echo "Tool: Jmeter"
                }
            }
            post {
                success {
                    notifyStatus("Code Analysis", "SUCCESS")
                }
                failure {
                    notifyStatus("Code Analysis", "FAILURE")
                }
            }
        }
        stage('Security Scan') {
            steps {
                script {
                    echo "Security Scan completed"
                    echo "Tool: Jmeter"
                }
            }
            post {
                success {
                    notifyStatus("Security Scan", "SUCCESS")
                }
                failure {
                    notifyStatus("Security Scan", "FAILURE")
                }
            }
        }
        stage('Deploy to Staging') {
            steps {
                script {
                    echo "Deployed to Staging"
                }
            }
        }
        stage('Integration Tests on Staging') {
            steps {
                script {
                    echo "Integration Tests on Staging passed"
                    echo "Tool: Jmeter"
                }
            }
        }
        stage('Deploy to Production') {
            steps {
                script {
                    echo "Deployed to Production"
                }
            }
        }
    }
    post {
        always {
            archiveArtifacts artifacts: '**/logs/**/*', allowEmptyArchive: true // Adjust the path to your log files
        }
    }
}

def notifyStatus(String stageName, String status) {
    def logFile = "logs/${stageName.replaceAll(" ", "_").toLowerCase()}_log.txt" // Log file name
    writeFile file: logFile, text: "Stage: ${stageName}\nStatus: ${status}\nLogs attached."
    
    mail to: "chermod2011@gmail.com",
         subject: "${stageName} - ${status}",
         body: "The stage '${stageName}' has finished with status: ${status}.\nLogs are attached.",
         attachLog: true
}
